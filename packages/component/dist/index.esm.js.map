{"version":3,"file":"index.esm.js","sources":["../index.js"],"sourcesContent":["/**\n * @module Component\n * @description  Manages a DOM component, binds UI and recursively binds child components.\n * Can be extended or instantiated\n * @example\n * // ./components/Slider.js\n *\n * import Component from '@okiba/component'\n * import SliderControls from '@components/SliderControls'\n *\n * const ui = {\n *   slides: '.slide',\n * }\n *\n * const components = {\n *   controls: {\n *     selector: '.slider-controls', type: SliderControls, options: {big: true}\n *   }\n * }\n *\n * class Slider extends Component {\n *   constructor({el, options}) {\n *     super({el, ui, components, options})\n *\n *     this.ui.slides.forEach(\n *       slide => slide.style.opacity = 0\n *     )\n *\n *     this.components.controls.forEach(\n *       controls => controls.onNext(this.next.bind(this))\n *     )\n *   }\n * }\n *\n * @example\n * // ./main.js\n *\n * import {qs} from '@okiba/dom'\n * import Component from '@okiba/component'\n * import Slider from './components/Slider'\n *\n * const app = new Component({\n *   el: qs('#app'),\n *   components: {\n *     selector: '.slider', type: Slider\n *   }\n * })\n */\nimport {qsa} from '@okiba/dom'\nimport {arrayOrOne} from '@okiba/arrays'\n\nfunction bindUi(ui, el) {\n  return Object.keys(ui).reduce(\n    (hash, key) => {\n      const els = arrayOrOne(qsa(ui[key].selector || ui[key], el))\n\n      if (els) {\n        hash[key] = els\n      } else if (!ui[key].optional) {\n        throw new Error(`[!!] [Component] Cant't find UI element for selector: ${ui[key]}`)\n      }\n\n      return hash\n    }, {}\n  )\n}\n\nfunction bindComponents(components, el) {\n  return Object.keys(components).reduce(\n    (hash, key) => {\n      const {type, selector, options, optional} = components[key]\n\n      if (typeof selector !== 'string' || !type) {\n        throw new Error(`[!!] [Component] Invalid component configuration for key: ${key}`)\n      }\n\n      const els = arrayOrOne(qsa(selector, el))\n      if (els) {\n        hash[key] = Array.isArray(els)\n          ? els.map(n => new type({el: n, options}))\n          : new type({el: els, options})\n      } else if (!optional) {\n        throw new Error(`[!!] [Component] Cant't find node with selector ${selector} for sub-component: ${key}`)\n      }\n\n      return hash\n    }, {}\n  )\n}\n\n/**\n * Accepts an __hash__ whose properties can be:\n * @param {Object} args Arguments to create a component\n * @param   {Element}   {el}       DOM Element to be bound\n * @param   {Object}    [{ui}]\n * UI hash where keys are name and values are selectors\n * ```javascript\n * { buttonNext: '#buttonNext' }\n * ```\n * Becomes:\n * ```javascript\n * this.ui.buttonNext\n * ```\n *\n * @param   {Object}    [{components}]\n * Components hash for childs to bind, keys are names and values are component initialization props:\n * ```javascript\n * {\n *   slider: {\n *     // Matched using [qs]('https://github/okiba-gang/okiba/packages/dom'), scoped to the current component element\n *     selector: '.domSelector',\n *     // Component class, extending Okiba Component\n *     type: Slider,\n *     // Options hash\n *     options: {fullScreen: true}\n *   }\n * }\n * ```\n *\n * Becomes:\n * ```javascript\n * this.components.slider\n * ```\n * @param   {Object}    [{options}]         Custom options passed to the component\n */\nclass Component {\n  constructor(args) {\n    this.el = args.el\n\n    if (args.options) {\n      this.options = args.options\n    }\n\n    if (args.ui) {\n      this.ui = bindUi(args.ui, args.el)\n    }\n\n    if (args.components) {\n      this.components = bindComponents(args.components, args.el)\n    }\n  }\n\n  /**\n   * @function onDestroy\n   * @description Virtual method, needs to be overridden\n   * It's the place to call cleanup functions as it will\n   * be called when your component is destroyed\n   */\n\n  /**\n   * Should not be overridden, will call `onDestroy`\n   * and forward destruction to all child components\n   */\n  destroy() {\n    if (this.onDestroy) {\n      this.onDestroy()\n    }\n\n    if (this.components) {\n      Object.keys(this.components)\n        .forEach(key => (this.components[key].length\n          ? this.components[key]\n          : [this.components[key]]\n        ).forEach(\n          c => c.destroy()\n        ))\n    }\n\n    this.components = null\n  }\n}\n\nexport default Component\n"],"names":["bindUi","ui","el","Object","keys","reduce","hash","key","els","arrayOrOne","qsa","selector","optional","Error","bindComponents","components","type","options","Array","isArray","map","n","Component","args","onDestroy","forEach","length","c","destroy"],"mappings":"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"}